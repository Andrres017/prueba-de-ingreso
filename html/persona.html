<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Hello, world!</title>
</head>
<!-- Modal -->
<div class="modal fade" id="formularioModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Formulario de persona</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="myForm">
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="number" style="display: none;" class="form-control" id="idModal" name="id"
                            required>
                        <input type="hidden" class="form-control" id="claveModal" name="Clave" required>
                        <input type="text" class="form-control" id="nombreModal" name="nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="apellido" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="apellidoModal" name="apellido" required>
                    </div>
                    <div class="mb-3">
                        <label for="direccion" class="form-label">Dirección</label>
                        <input type="text" class="form-control" id="direccionModal" name="direccion" required>
                    </div>
                    <div class="mb-3">
                        <label for="telefono" class="form-label">Teléfono</label>
                        <input type="number" class="form-control" id="telefonoModal" name="telefono" required>
                    </div>
                    <div class="mb-3">
                        <label for="correo" class="form-label">Correo electrónico</label>
                        <input type="email" class="form-control" id="correoModal" name="correo" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Enviar</button>
                    <button id="cerrarModal" type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Cerrar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<body>
    <div class="container-fluid">
        <div class="row">

            <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="./inicio.html">
                                <span data-feather="home"></span>
                                Inicio
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./persona.html">
                                <span data-feather="user"></span>
                                Persona
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./maritima.html">
                                <span data-feather="tag"></span>
                                Logistica maritima
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./camion.html">
                                <span data-feather="tag"></span>
                                Logistica de camiones
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./index.html">
                                <span data-feather="log-out"></span>
                                Salir
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

                <div class="pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Personas</h1>
                </div>
                <div class="card col-md-12">
                    <div class="card-body">
                        <h5 class="card-title">Buscar</h5>
                        <form>
                            <div class="form-group">
                                <label for="select-campo">Campo de búsqueda:</label>
                                <select class="form-control" id="campo">
                                    <option value="nombre">Nombre</option>
                                    <option value="apellido">Apellido</option>
                                    <option value="direccion">Direccion</option>
                                    <option value="telefono">Telefono</option>
                                    <option value="correo">Correo</option>
                                    <option value="id">ID</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="input-valor">Valor:</label>
                                <input type="text" class="form-control" id="valor">
                            </div>
                            <button onclick="getFilter()" type="button" class="btn btn-primary">Buscar</button>
                        </form>
                    </div>
                </div>
                <div class="row">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Dirección</th>
                                <th>Teléfono</th>
                                <th>Correo</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="table">
                        </tbody>
                    </table>

                </div>
            </main>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <script>
        feather.replace();
        getPersonas()
        function getPersonas() {
            fetch('http://localhost:9000/persona/api/all', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
                .then(response => response.json())
                .then(data => {
                    var string = ""
                    data.forEach(persona => {
                        string += `
                            <tr>
                                <td>${persona.id}</td>
                                <td>${persona.nombre}</td>
                                <td>${persona.apellido}</td>
                                <td>${persona.direccion}</td>
                                <td>${persona.telefono}</td>
                                <td>${persona.correo}</td>
                                <td>
                                    <button onclick="deletePersona(${persona.id})" class="btn btn-danger btn-sm">Eliminar</button>
                                    <button onclick="getPersona(${persona.id})" type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#formularioModal">Actualizar</button>
                                </td>
                            </tr>
                    `
                        console.log(persona);
                        // Aquí puedes hacer lo que necesites con la información de cada persona
                    });
                    document.getElementById("table").innerHTML = string
                })
                .catch(error => console.error(error));
        }
        function deletePersona(id) {
            fetch('http://localhost:9000/persona/api/delete/' + id, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
                .then(response => response.json())
                .then(data => getPersonas())
                .catch(error => alert(error));
        }
        function getPersona(id) {
            fetch('http://localhost:9000/persona/api/find/' + id, {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    document.getElementById("nombreModal").value = data.nombre
                    document.getElementById("idModal").value = data.id
                    document.getElementById("apellidoModal").value = data.apellido
                    document.getElementById("direccionModal").value = data.direccion
                    document.getElementById("telefonoModal").value = data.telefono
                    document.getElementById("correoModal").value = data.correo
                    document.getElementById("claveModal").value = data.clave
                })
                .catch(error => alert(error));
        }
        const myForm = document.getElementById('myForm');
        myForm.addEventListener('submit', (event) => {
            event.preventDefault(); // evitar que el formulario se envíe automáticamente
            const formData = new FormData(myForm); // obtener los datos del formulario
            const data = Object.fromEntries(formData); // convertir los datos en un objeto JSON
            console.log(data)
            data.id = data.id * 1

            // enviar el objeto JSON usando fetch
            fetch('http://localhost:9000/persona/api/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    getPersonas()
                    document.getElementById("cerrarModal").click()
                })
                .catch(error => {
                    alert('Error al enviar el formulario:', error);
                });
        });
        function getFilter() {
            let campo = document.getElementById("campo").value
            let value = document.getElementById("valor").value
            fetch('http://localhost:9000/persona/api/findfilter/' + campo + '/' + value, {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                },
            })
                .then(response => response.json())
                .then(data => {
                    var string = ""
                    data.forEach(persona => {
                        string += `
                            <tr>
                                <td>${persona.id}</td>
                                <td>${persona.nombre}</td>
                                <td>${persona.apellido}</td>
                                <td>${persona.direccion}</td>
                                <td>${persona.telefono}</td>
                                <td>${persona.correo}</td>
                                <td>
                                    <button onclick="deletePersona(${persona.id})" class="btn btn-danger btn-sm">Eliminar</button>
                                    <button onclick="getPersona(${persona.id})" type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#formularioModal">Actualizar</button>
                                </td>
                            </tr>
                    `
                        console.log(persona);
                        // Aquí puedes hacer lo que necesites con la información de cada persona
                    });
                    document.getElementById("table").innerHTML = string
                })
                .catch(error => console.error(error));
        }
        function logOut() {
            localStorage.removeItem('token');
            window.location.href = "./index.html";
        }
    </script>



</body>

</html>